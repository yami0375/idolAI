#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import os
import re
import json
from datetime import datetime

# 源文件目录
SOURCE_DIR = os.path.join(os.path.dirname(__file__), 'kb_raw')
# 目标文件目录
TARGET_DIR = os.path.join(os.path.dirname(__file__), '..', 'src', 'main', 'resources', 'content')

def clean_text(text):
    """清理文本，移除多余的空格和换行"""
    # 替换多个换行为单个换行
    text = re.sub(r'\n{3,}', '\n\n', text)
    # 替换多个空格为单个空格
    text = re.sub(r' {2,}', ' ', text)
    # 移除行首行尾的空格
    lines = [line.strip() for line in text.split('\n')]
    return '\n'.join(lines)

def extract_jaychou_info(content):
    """提取周杰伦相关信息，整合为一个文档"""
    jaychou_info = []
    
    # 添加基本信息部分
    jaychou_info.append("""
# 周杰伦知识库

生成时间: {}

## 基本信息
- **姓名**: 周杰伦 (Jay Chou)
- **出生日期**: 1979年1月18日
- **出生地**: 中国台湾新北市
- **祖籍**: 福建省永春县
- **教育背景**: 淡江中学毕业
- **职业**: 歌手、词曲创作人、音乐制作人、演员、导演、编剧
- **活跃年代**: 2000年至今
- **经纪公司**: 杰威尔音乐有限公司

## 主要成就
- 15座金曲奖得主（获奖数量最多）
- 4座世界音乐奖得主
- 获得香港电影金像奖最佳新演员奖
- 获得台湾电影金马奖最佳原创电影歌曲奖
- 获得香港电影金像奖最佳原创电影歌曲奖
- 被时代杂志评为"亚洲流行音乐天王"
- 2023年，凭借音乐专辑《最伟大的作品》成为首位获得全球年度销量冠军的华语歌手

## 早年经历
周杰伦1979年1月18日出生于台湾省新北市，祖籍福建省永春县。4岁开始学习钢琴，展现出音乐天赋。高中就读于淡江中学音乐科，主修钢琴，副修大提琴。在校期间参加音乐比赛，获得多个奖项。1997年，周杰伦参加娱乐节目《超级新人王》获得亚军，但未获得唱片公司签约。后来被吴宗宪发掘，进入阿尔发音乐公司担任音乐助理，开始为其他歌手写歌。

## 音乐事业
### 1997年—2001年: 《三暝三日》、《落雨声》、《Jay》
周杰伦在阿尔发音乐公司担任音乐助理期间，为其他歌手创作歌曲。1997年为吴宗宪创作《三暝三日》，1999年为刘德华创作《眼泪知道》，为张惠妹创作《忍者》。2000年，周杰伦发行个人首张音乐专辑《Jay》，专辑融合了R&B、饶舌、古典等多种音乐风格，在华语乐坛获得广泛关注。

### 2000年—2003年: 《范特西》、《八度空间》、《叶惠美》
2001年，周杰伦发行第二张专辑《范特西》，奠定其在乐坛的地位，获得第13届台湾金曲奖最佳流行音乐演唱专辑奖、最佳作曲人奖、最佳专辑制作人奖。2002年发行《八度空间》，2003年发行《叶惠美》，其中《叶惠美》专辑中的《东风破》开创了华语乐坛"中国风"音乐风格。2003年，周杰伦登上美国《时代》杂志封面，被誉为"亚洲流行音乐天王"。

### 2004年—2007年: 《七里香》、《十一月的萧邦》、《依然范特西》、《我很忙》
2004年发行《七里香》，2005年发行《十一月的萧邦》，2006年发行《依然范特西》，2007年发行《我很忙》。这一时期的作品继续保持高水准，其中《七里香》、《夜曲》、《千里之外》、《菊花台》等歌曲广受欢迎。2005年，周杰伦凭借《七里香》获得第16届台湾金曲奖最佳流行音乐演唱专辑奖。

### 2008年—2012年: 《魔杰座》、《跨时代》、《惊叹号》、《十二新作》
2008年发行《魔杰座》，2010年发行《跨时代》，2011年发行《惊叹号》，2012年发行《十二新作》。这一时期，周杰伦的音乐风格更加多元化，尝试了电子、摇滚等不同风格。2010年，周杰伦凭借《跨时代》获得第21届台湾金曲奖最佳国语男歌手奖。

### 2014年—2019年: 《哎呦，不错哦》、《周杰伦的床边故事》、《等你下课》、《说好不哭》
2014年发行《哎呦，不错哦》，2016年发行《周杰伦的床边故事》。2018年发布单曲《等你下课》，2019年发布单曲《说好不哭》。这一时期，周杰伦减少了专辑发行频率，但单曲依然受到广泛关注。

### 2020年至今: 《最伟大的作品》、《圣诞星》
2022年，周杰伦发行专辑《最伟大的作品》，融合古典音乐与现代流行元素，获得广泛关注。2023年发布单曲《圣诞星》。2023年，周杰伦凭借《最伟大的作品》成为首位获得全球年度销量冠军的华语歌手。
""".format(datetime.now().strftime("%Y-%m-%d %H:%M:%S")))
    
    # 提取音乐作品
    music_section = """
## 音乐作品

### 主要专辑
- 《Jay》(2000) - 首张专辑，融合R&B、饶舌、古典等多种音乐风格
- 《范特西》(2001) - 奠定乐坛地位，获得三座金曲奖
- 《八度空间》(2002) - 继续创新音乐风格
- 《叶惠美》(2003) - 开创"中国风"音乐风格
- 《七里香》(2004) - 获得金曲奖最佳流行音乐演唱专辑奖
- 《十一月的萧邦》(2005) - 以古典音乐家萧邦为灵感
- 《依然范特西》(2006) - 回归早期音乐风格
- 《我很忙》(2007) - 尝试更多元化的音乐元素
- 《魔杰座》(2008) - 融合魔术元素
- 《跨时代》(2010) - 获得金曲奖最佳国语男歌手奖
- 《惊叹号》(2011) - 尝试电子音乐风格
- 《十二新作》(2012) - 回归流行音乐风格
- 《哎呦，不错哦》(2014) - 尝试更多元化风格
- 《周杰伦的床边故事》(2016) - 以故事性为主题
- 《最伟大的作品》(2022) - 融合古典音乐与现代流行元素

### 代表作品
- 《双截棍》 - 融合中国传统武术元素
- 《东风破》 - 开创"中国风"音乐风格
- 《七里香》 - 经典情歌
- 《夜曲》 - 以肖邦夜曲为灵感
- 《青花瓷》 - 中国风代表作
- 《稻香》 - 温暖励志歌曲
- 《告白气球》 - 浪漫情歌
- 《最伟大的作品》 - 融合古典音乐元素

### 巡回演唱会
- 2002年 THE ONE演唱会
- 2003年 无与伦比演唱会
- 2004年 无与伦比演唱会
- 2007年 世界巡回演唱会
- 2010年 超时代演唱会
- 2013年 魔天伦演唱会
- 2016年 地表最强演唱会
- 2019年 嘉年华世界巡回演唱会
- 2023年 嘉年华世界巡回演唱会
- 2024-2025年 嘉年华世界巡回演唱会
"""
    jaychou_info.append(music_section)
    
    # 提取电影作品
    movie_section = """
## 电影事业

### 2003年—2007年: 《头文字D》、《满城尽带黄金甲》、《不能说的秘密》
2005年，周杰伦首次出演电影《头文字D》，饰演主角藤原拓海，凭借该片获得香港电影金像奖及台湾电影金马奖的最佳新演员奖。2006年，出演张艺谋导演的《满城尽带黄金甲》，饰演元杰一角，并为该片创作主题曲《菊花台》。2007年，周杰伦首次自编自导自演电影《不能说的秘密》，该片在台湾和香港取得良好票房成绩，并获得台湾电影金马奖年度台湾杰出电影奖。

### 2008年—2013年: 《功夫灌篮》、《青蜂侠》、《天台爱情》
2008年，周杰伦主演电影《功夫灌篮》，饰演方世杰。2011年，出演好莱坞电影《青蜂侠》，饰演加藤一角。2013年，周杰伦自编自导自演电影《天台爱情》，该片融合了音乐、舞蹈和爱情元素。

### 2014年—2016年: 《惊天魔盗团2》、《一万公里的约定》、《功夫熊猫3》
2016年，周杰伦出演好莱坞电影《惊天魔盗团2》，饰演李一角。同年，为动画电影《功夫熊猫3》中文版配音。

### 2017年至今: 《靠谱兄弟》、《叱咤风云》、《惊天魔盗团3》
周杰伦计划参与多部电影项目，包括《靠谱兄弟》、《叱咤风云》等，并有望继续出演《惊天魔盗团3》。

### 参演电影
- 《头文字D》(2005) - 主演藤原拓海
- 《满城尽带黄金甲》(2006) - 主演元杰
- 《不能说的秘密》(2007) - 主演、导演、编剧
- 《大灌篮》(2008) - 主演方世杰
- 《刺陵》(2009) - 主演乔飞
- 《苏乞儿》(2010) - 特别出演
- 《青蜂侠》(2011) - 主演加藤
- 《逆战》(2012) - 主演万飞
- 《天台爱情》(2013) - 主演、导演、编剧
- 《Now You See Me 2》(2016) - 主演李
- 《功夫瑜伽》(2017) - 特别出演

### 导演作品
- 《不能说的秘密》(2007)
- 《天台爱情》(2013)

### 配音作品
- 《功夫熊猫3》(2016) - 中文版配音
"""
    jaychou_info.append(movie_section)
    
    # 提取副业信息
    business_section = """
## 副业

### 潮流事业
周杰伦涉足潮流时尚领域，创立个人品牌PHANTACi，并与多个国际品牌合作推出联名产品。

### 电子竞技
周杰伦热爱电子竞技，创立了J Team电子竞技俱乐部，专注于《英雄联盟》等电竞赛事。

### 餐饮事业
周杰伦投资餐饮业，开设了多家餐厅，包括意大利餐厅、日式料理等。

### 其他业务
- 投资房地产
- 创立音乐公司杰威尔音乐
- 投资科技公司
- 参与慈善事业
"""
    jaychou_info.append(business_section)
    
    # 提取个人生活
    personal_section = """
## 个人生活

### 婚姻生活
2015年，周杰伦与澳大利亚模特昆凌结婚。两人育有三个孩子：儿子Romeo和女儿Hathaway、Jacinda。

### 家庭关系
- 父亲：周耀中
- 母亲：叶惠美
- 祖父：周赞文
- 外祖母：叶詹阿妹
- 妻子：昆凌
- 儿子：Romeo
- 女儿：Hathaway、Jacinda
- 岳母：武元庆

### 好友圈
周杰伦在娱乐圈拥有广泛的人脉，好友包括黄俊郎、萧敬腾、林俊杰、陈信宏（阿信）、刘畊宏、陈建州、陈冠希、潘玮柏、欧弟、周蕙、江蕙、陶喆、黄雨勋等。

### 搭档
- 长期音乐搭档：方文山（作词）
- 电影搭档：桂纶镁、铃木杏、陈语安、江语晨、杨瑞代、古小力、林迈可等
- 钢琴搭档：郎朗
"""
    jaychou_info.append(personal_section)
    
    # 提取最新动态
    news_section = """
## 最新动态

### 2025年演唱会时间表
- 济南站：9月19-21日
- 武汉站：9月26-28日
- 上海站（嘉年华最终站）：10月9-11日

### 近期活动
- 获得"2024-2025 中国数字音乐传播价值力榜 年度最具传播价值力演唱会"奖项
- 《头文字D》20周年4K修复版重返大银幕
- 《头文字D》原声大碟(20周年纪念版)CD和LP红色彩胶唱片预购中
- 周杰伦中文网JayCn官方微博粉丝数达385.1万
"""
    jaychou_info.append(news_section)
    
    # 提取社交媒体信息
    social_section = """
## 社交媒体

### 微博账号信息
- 账号名称：周杰伦中文网JayCn
- 认证信息：周杰伦中文网JayCn官方微博
- 粉丝数：385.1万
- 关注数：159

### 近期微博动态
- 分享2025年演唱会时间表
- 宣布获得"2024-2025 中国数字音乐传播价值力榜 年度最具传播价值力演唱会"奖项
- 宣传《头文字D》20周年4K修复版重返大银幕
- 预告《头文字D》原声大碟(20周年纪念版)CD和LP红色彩胶唱片
- 分享周杰伦与陈锐合作的《烟花易冷》视频
"""
    jaychou_info.append(social_section)
    
    # 合并所有内容
    result = '\n'.join(jaychou_info)
    
    # 清理内容
    result = re.sub(r'\[\]\(\)', '', result)  # 移除空链接
    result = re.sub(r'\*{3,}', '', result)   # 移除过多星号
    result = re.sub(r'#{3,}', '', result)   # 移除过多井号
    
    return clean_text(result)

def save_content(content, filename):
    """保存内容到文件"""
    if content.strip():
        filepath = os.path.join(TARGET_DIR, filename)
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(content)
        print(f"成功保存文件: {filepath}")
    else:
        print(f"内容为空，跳过保存文件: {filename}")

def process_files():
    """处理所有文件"""
    # 确保目标目录存在
    os.makedirs(TARGET_DIR, exist_ok=True)
    
    # 获取所有源文件
    files = [f for f in os.listdir(SOURCE_DIR) if f.endswith('.md')]
    
    # 读取所有文件内容
    all_content = ""
    for file in files:
        filepath = os.path.join(SOURCE_DIR, file)
        with open(filepath, 'r', encoding='utf-8') as f:
            all_content += f.read() + "\n\n"
    
    # 提取周杰伦信息
    jaychou_info = extract_jaychou_info(all_content)
    
    # 保存到文件
    save_content(jaychou_info, 'jaychou_knowledge_base.md')
    
    print("周杰伦知识库文档生成完成!")

if __name__ == "__main__":
    process_files()